10 CLEAR 400,&HD000:COLOR 15,0,0:SCREEN 5
20 DIM AD%(10)
30 BLOAD"IOTCMD.BIN"
40 AD%=&HD000:FOR I%=0 TO 10:AD%(I%)=AD%+I%*3:NEXT I%
50 DEFUSR0=AD%(0) 'set_flag
60 DEFUSR1=AD%(1) 'iot_node
70 DEFUSR2=AD%(2) 'iot_put_i
80 DEFUSR3=AD%(3) 'iot_put_s
90 DEFUSR4=AD%(4) 'iot_get_i
100 DEFUSR5=AD%(5) 'iot_get_s
110 DEFUSR6=AD%(6) 'iot_find_i
120 DEFUSR7=AD%(7) 'iot_find_s
130 'DEFUSR8=AD%(8) 'iot_read_i
140 DEFUSR9=AD%(9) 'iot_read_s
150 DEFUSR8=AD%(10) 'get_datetime
160 _TURBO ON
170 '
1000 'SAVE"CLOCK.BAS"
1010   DEFINT X,Y,I,J,Q,T,P,C
1020   DIM X(8),Y(8),CO(2),L(2),S(90)
1021   TR%=1E-40=0:IF TR% THEN A%=USR(1)'TURBO? NORMAL?
1022   GT$="GET TIME":GD$="GET DATE"
1030   X0=256/2:Y0=212/2       'center
1040   L(0)=35:L(1)=60:L(2)=70 'length
1050   CF=15:CH=14:CB=1        'color
1060   P$="":EC=0
1070   GOSUB 1610
1080   SCREEN 5:COLOR CF,CB,0:CLS:COLOR=(CH,2,2,2)
1090   'OPEN "GRP:" FOR OUTPUT AS#1
1100 'Draw clock face
1110   FOR I=0 TO 60 STEP 5
1120     J=I+45
1130     R=96
1140     Q=J*6:GOSUB 1690:X(0)=U*R+X0
1150     Q=J*6:GOSUB 1650:Y(0)=U*R+Y0
1160     R=80
1170     Q=J*6:GOSUB 1690:X(1)=U*R+X0
1180     Q=J*6:GOSUB 1650:Y(1)=U*R+Y0
1190     LINE(X(0),Y(0))-(X(1),Y(1)),CF
1200   NEXT I
1210   'CIRCLE(X0,Y0),80,CH
1220   'CIRCLE(X0,Y0),96,CH
1221   SETPAGE 0,1:COPY(0,0)-(255,211),0 TO (0,0),1
1230 'Wait event
1240   IF PAD(4)<>0 THEN EC=EC+1 ELSE EC=0
1250   IF EC>=10 THEN 3000'RUN"SYSMENU.BAS"
1260   T$=LEFT$(GT$,8):A%=USR8(VARPTR(T$))'GET TIME T$
1270   IF T$=P$ THEN 1230
1280   TIME=0:FOR I=0 TO 1:I=TIME:NEXT I'FOR I=0 TO 100:NEXT I
1290   T$=LEFT$(GT$,8):A%=USR8(VARPTR(T$))'GET TIME T$
1300   D$=LEFT$(GD$,8):A%=USR8(VARPTR(D$))'GET DATE D$
1310   K$=T$:GOSUB 1430
1320   FOR I=0 TO 2:X(I)=X(I+6):Y(I)=Y(I+6):NEXT I
1330   IF P$<>"" THEN CO(0)=CB:CO(1)=CB:CO(2)=CB:GOSUB 1560
1340 'Draw
1350   LINE(100,160)-(256,170),CB,BF
1360   PRESET(100,150):C$=D$:GOSUB 1900'PRINT #1,D$
1370   PRESET(100,160):C$=T$:GOSUB 1900'PRINT #1,T$
1380   FOR I=0 TO 2:X(I)=X(I+3):Y(I)=Y(I+3):NEXT I
1390   CO(0)=CF:CO(1)=CF:CO(2)=CH:GOSUB 1560
1400   FOR I=0 TO 2:X(I+6)=X(I+3):Y(I+6)=Y(I+3):NEXT I
1401   COPY(0,0)-(255,211),1 TO (0,0),0
1410   P$=T$
1420   GOTO 1230
1430 'Calculate X Y
1440   FOR I=2 TO 0 STEP -1
1450     OJ=J
1460     J=VAL(MID$(K$,3*I+1,2))
1470     IF I=0 THEN K=J*60/12+OJ*5/60
1480     IF I=1 THEN K=J+OJ/60
1490     IF I=2 THEN K=J
1500     K=K+45
1510     R=L(I)
1520     Q=K*6:GOSUB 1690:X(I+3)=U*R+X0
1530     Q=K*6:GOSUB 1650:Y(I+3)=U*R+Y0
1540   NEXT I
1550   RETURN
1560 'Draw clock hands
1570   FOR I=2 TO 0 STEP -1
1580     LINE(X(I),Y(I))-(X0,Y0),CO(I)
1590   NEXT I
1600   RETURN
1610 'Create Sin table
1620   'FOR I=0 TO 90:S(I)=SIN(2*3.14*I/360):NEXT I:RETURN
1630   FOR I=0 TO 90:READ S(I):NEXT I:RETURN
1640 'Sin
1650   Q=(Q+360)MOD360:T=Q\90:V=1+(T\2=1)*2
1660   IF TMOD2=1 THEN RR=90-(QMOD90)ELSE RR=QMOD90
1670   U=V*S(RR):RETURN
1680 'Cos
1690   Q=Q+90:GOTO 1650
1700 'Sin Data
1710   DATA .0000, .0174, .0348, .0523, .0697, .0871, .1044, .1218, .1391, .1563
1720   DATA .1735, .1907, .2078, .2248, .2418, .2586, .2755, .2922, .3088, .3254
1730   DATA .3418, .3581, .3744, .3905, .4065, .4224, .4381, .4537, .4692, .4845
1740   DATA .4997, .5148, .5296, .5443, .5589, .5733, .5875, .6015, .6153, .6290
1750   DATA .6425, .6557, .6688, .6817, .6943, .7068, .7190, .7310, .7428, .7544
1760   DATA .7657, .7768, .7877, .7983, .8087, .8188, .8287, .8383, .8477, .8568
1770   DATA .8657, .8743, .8826, .8907, .8985, .9060, .9133, .9202, .9269, .9333
1780   DATA .9394, .9453, .9508, .9561, .9610, .9657, .9701, .9742, .9780, .9814
1790   DATA .9846, .9875, .9901, .9924, .9944, .9961, .9975, .9985, .9993, .9998
1800   DATA .9999
1900 'PRINT#1
1910 FOR IC=1 TO LEN(C$):C%=ASC(MID$(C$,IC,1)):GOSUB 2000:NEXT IC:RETURN
1998 'usage: PRESET(x,y):C%=CHR:GOSUB 2000
1999 'X%=X(WORK),Y%=Y(WORK)
2000 '#I &H2A,C%,&H29,&H29,&H29,&H11,&HBF,&H1B,&H19
2010 '#I &H06,&H08,&H3A,&HB7,&HFC,&H32,X%,&H3A,&HB9,&HFC,&H32,Y%
2020 '#I &H7E,&H23,&HC5,&H06,&H08
2030 '#I &H17,&HF5,&HC5,&HE5,&HDC,@2070,&HE1,&HC1,&H3A,X%,&H3C,&H32,X%,&HF1
2040 '#I &H10,&HED,&H3A,X%,&HD6,&H08,&H32,X%,&H3A,Y%,&H3C,&H32,Y%,&HC1,&H10,&HD6
2050 '#I &H3A,X%,&HC6,&H08,&H32,&HB7,&HFC,&H3A,Y%,&H38,2,&HD6,&H08
2060 '#I &H32,&HB9,&HFC,&HC9
2070 PSET(X%,Y%):RETURN
2080 '
3000 _TURBO OFF
3010 RUN"SYSMENU.BAS"
