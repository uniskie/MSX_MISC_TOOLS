## GSRLE

これはBSAVE画像をグラフサウルス圧縮形式で圧縮するものです。

- 圧縮済みデータには対応していません

### 使い方
gsrle.exeにドロップしてください。
同じフォルダに圧縮後のファイルが出来ます。

- 圧縮後の出力ファイル名はSR?やR??になります
- BSAVE形式の拡張子と判断した場合はパレットファイル(*.PL?)も出力します。
- ※SCREEN8以上の場合はパレットは出力しません。

パレットファイルの有無、画面モードなどは拡張子から判断します。

## GRAPH ZAURUS画像

ピクセルデータとパレットデータに分かれている。  
- パレットデータは16色の8トラック(バンク)切り替えに(画像表示中にカーソル左右)
- _ランレングス圧縮されたデータにも対応_

| 画面モード  | 拡張子  | 説明                               | 自動インターレース表示[^2]|
|-------------|---------|------------------------------------|---------------------------|
| SCREEN5     | SR5     | 画素情報(ベタまたはラレングス圧縮) |                           |
|             | PL5     | カラーパレット(16色トラック0～8個) |                           |
| SCREEN7     | SR7     | 画素情報(ベタまたはラレングス圧縮) |                           |
|             | PL7     | カラーパレット(16色トラック0～8個) |                           |
| SCREEN8     | SR8     | 画素情報(ベタのみ)                 |                           |
| SCREEN12    | SRS     | 画素情報(ベタのみ)                 |                           |

## GRAPH SAURUS 圧縮形式メモ

解析したグラフサウルス圧縮形式のメモになります。

基本はRLE(ランレングス圧縮)ベースになっていて非常に単純です。
グラフサウルス独自の工夫として、カラーコード0番を使用しないことを前提に圧縮効率を高めているようです。

### データマップ

基本はBSAVE形式と同一ですが、ヘッダIDの値が拡張されています。  
ヘッダIDは通常のBSAVEファイルは$FEですが、圧縮ファイルの時は$FDになっています。


|位置 | サイズ  | 内容                                       |
|-----|---------|--------------------------------------------|
|+00  | 1       | ID ( $FE=ベタイメージ / $FD=圧縮イメージ ) |
|+01  | 2       | SA (格納元開始アドレス)                    |
|+03  | 2       | EA (格納元終了アドレス)                    |
|+05  | 2       | RA (実行開始アドレス/画像データでは未使用) |
|+07  | EA-SA+1 | データ本体                                 |

### 圧縮データ

- 1byte単位で処理します。
- SCREEN5～7は4bitカラーなので、2ピクセル単位での処理になります。
- データモードは3つあります。

| 動作名(仮)    | サイズ |  説明
|---------------|--------|------------------------------------------ 
| 直接描画      | 1      | 1byte目が16以上の場合、その値を直接書き込む
| 連続書き込み1 | 2      | 1byte目が1～15の場合、その回数だけ、2byte目で指定された値を書き込む
| 連続書き込み2 | 3      | 1byte目が0の場合、2byte目で指定された数だけ、3byte目で指定された値を書き込む

- ピクセル値$00～$0Fが多く点在すると異常に効率が悪くなるものの、
そうでないデータでは、元サイズよりも小さなデータに圧縮されることが期待できます。

- カラー0は透明色扱いであるため、基本的にそのような画像を扱う事は少ないと思います。 
半透明風網掛けパーツなどの場合、連続するので連続書き込みによって圧縮されます。

- 3ドット単位の透明色タイリングで埋め尽くしたデータが最も効率が悪く、ベタデータよりも大きくなると思われます。



