;================================
; INCLUDE FILE for LOADSRD 
;================================
;USR():
;	SPR_TIME - write TIME
;		   to SPR_PAT No
;		   of SPR#0 - #7
;================================
;---- WRITE TIME to SPRITE ----
;     for CLOCK.BAS
EXTROM:		EQU	015FH
REDCLK:		EQU	01F5H
WRTCLK:		EQU	01F9H
ATRBAS:		EQU	0F928H
TIMEBUF:	DS	8
TIMECNT:	DB	11
;
;VDPIOR:	EQU	0006H	;VDP I/O port m (READ)
;VDPIOW:	EQU	0007H	;VDP I/O port n (WRITE)
;
REDCRAM:	;
	PUSH	BC
	PUSH	HL
	LD	IX,REDCLK
	CALL	EXTROM
	POP	HL
	POP	BC
	RET
;
WRTCRAM:	;
	PUSH	BC
	PUSH	HL
	LD	IX,WRTCLK
	CALL	EXTROM
	POP	HL
	POP	BC
	RET
;
;--- MAIN ---
;
SPR_TIME:	;
; (24¼Þ¶ÝË®³¼Þ)
	LD	A,1
	LD	C,1AH
	CALL	WRTCRAM
;
	LD	C,5
	LD	B,6
	LD	HL,TIMEBUF
TIMSPR_0:	;
	CALL	REDCRAM
	DEC	C
	INC	A
	RLCA
	RLCA
	LD	(HL),A
	INC	HL
	DJNZ	TIMSPR_0
; (ÃÞ°ÀÉ ¾²ÚÂ)
	LD	HL,(TIMEBUF+4)
	LD	(TIMEBUF+6),HL
	LD	HL,(TIMEBUF+2)
	LD	(TIMEBUF+3),HL
	LD	A,(TIMECNT)
	RLCA
	RLCA
	LD	(TIMEBUF+2),A
	LD	(TIMEBUF+5),A
; (ÃÝÒÂ)
	LD	A,(TIMECNT)
	XOR	4
	LD	(TIMECNT),A
; (VDPºÏÝÄÞ ¼­³Ø®³ÏÁ)
	CALL	WAITCMD
;
	LD	DE,(ATRBAS)	;sprite atr.
	CALL	VSETWR2
	DEC	C
	LD	B,8+8
	LD	HL,TIMEBUF
TIMSPR_2:	;
	IN	A,(C)
	IN	A,(C)
	OUTI
	IN	A,(C)
	DJNZ	TIMSPR_2
	EI
	RET
