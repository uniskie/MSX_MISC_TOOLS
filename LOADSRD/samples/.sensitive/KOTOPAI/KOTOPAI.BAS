1000 COLOR 15,0,0:VDP(9)=VDP(9)AND253
1010 '
1020 CLEAR 200,&HB000:DEFINT A-Z
1030 DIM P(255),X(8,3),Y(8,3),A(3),W(3),AP(9,3),AF(3),VC(15,8,3)
1040 SCREEN7:DEFUSR=&H156
1050 BLOAD"SRX.BIN"
1060 DEFUSR1=&HD000 'LOAD_SR
1070 DEFUSR2=&HD003 'SET_PAL
1080 DEFUSR3=&HD006 'TIMER SPRITE
1090 DEFUSR4=&HD009 'VDP COMMAND
1100 DEFUSR5=&HD00C 'VDP COMMAND WAIT
1110 F$="KOTOPAI"
1120 COPY F$+".PL7" TO P
1130 FOR I=0TO7:P(I*16)=33:NEXT
1140 PN=0:GOSUB 2430
1150 SCREEN,2:BLOAD"TIME.SPR",S,&H7800
1160 SETPAGE0,1:A$=USR1(F$+".SR7"):SETPAGE0,0
1170 FOR I=0TO3
1180  READ X(0,I),Y(0,I)
1190  FOR J=1 TO 8
1200   READ X(J,I),Y(J,I)
1210   VC(0,J,I)=X(J,I):VC(1,J,I)=Y(J,I)+256 'SX,SY
1220   VC(2,J,I)=X(1,I):VC(3,J,I)=Y(1,I) 'DX,DY
1230   VC(4,J,I)=X(0,I):VC(5,J,I)=Y(0,I) 'NX,NY
1240   VC(6,J,I)=0 'COLOR+ARG*256
1250   VC(7,J,I)=&HD0 'CMD HMMM
1260  NEXT
1270  READ A$,B$
1280  FOR J=0 TO 9
1290   AP(J,I)=VAL(MID$(A$,J+1,1))
1300  NEXT
1310 NEXT
1320 '     SIZE     ORG     ANIME1,2,3,4,5,6,7(X,Y)
1330 DATA 245,203,  130, 4,  130, 4, 130, 3, 130, 2, 130,1, 0,0, 0,0, 0,0
1340 DATA "132121....",BODY
1350 DATA  94,68,   172,126,  172,127, 172,128, 172,129, 142,130, 0,0, 0,0, 0,0
1360 DATA "1231321...",BUSTL
1370 DATA 101,66,   274,122,  274,123, 274,124, 274,125, 274,126, 0,0, 0,0, 0,0
1380 DATA "122.......",BUSTR
1390 DATA 256,211,  128, 0, 128,1, 128,2, 128,3, 128,4, 0,0, 0,0, 0,0
1400 DATA "123421....",BODY2
1410 '
1420 FOR I=0 TO 7:PUTSPRITE I,(89+I*12,122),6,15:COLORSPRITE$(I)=STRING$(4,7)+STRING$(4,9):NEXT
1430 'µÔ¼Þ É »ÞË®³
1440 KX=95:KY=140:P0=4:P1=8:P2=4'12
1450 PUTSPRITE 9,(KX+73,KY),13,15-P2\4
1460 PUTSPRITE 8,(KX+73,KY),7 ,15-P1\4
1470 PUTSPRITE 31,(KX,KY+2),15,15-P0\4
1480 O1=52:O2=48:MF=56
1490 '
1500 ONINTERVAL=8 GOSUB 2290:GOSUB 2290
1510 '
1520 A$="t80l8s0m20000o5 ge-o4b-o5e- fb-4. fgfo4b-o5e-2"
1530 B$="t80l8v13o4 r4g4o5d4.o4f b-4 b-4 sm20000g2"
1540 PLAY A$,B$
1550 '
1560 'ºËß° »· É »ÞË®³
1570 OX=0:OY=0
1580 COPY (0,0)-(511,211),1 TO (OX,OY),0
1590 TM=TC:EF=((TM AND 16)>0)
1600 'VDP(26)=2
1610 '
1620 'MAIN LOOP
1630 'VS=(VS-1)AND255:VDP(27)=VS\8:VDP(28)=255-VS
1640 I$=INKEY$:A=USR(0)
1650 IF I$=" " THEN GOSUB 2380
1660 IF I$<>CHR$(13) THEN 1680
1670 O1=60+(O1=60)*P1:O2=60+(O2=60)*P2:VPOKE -1502,O1:VPOKE -1498,O2
1680 IF I$<>CHR$(11) THEN 1700
1690 MF=60+(MF=60)*P0:VPOKE -1410,MF
1700 ' (ANIMATION)
1710 VPOKE -1412,KY+TF+TF+2
1720 VPOKE -1504,KY+TF+TF
1730 VPOKE -1500,KY+TF+TF
1740 EB=TM
1750 TM=TC:EF=((TM AND 16)>0)
1760 IF EB=TM THEN 1730
1770 IF EF THEN GOSUB2380 'ÊßÚ¯Ä +1
1780 'A=3:GOSUB 2080
1790 A=0:GOSUB 1890
1800 A=2:GOSUB 2090
1810 A=1:GOSUB 1990
1820 GOTO 1620
1830 '-------MAIN END
1840 ' COPY
1850 U=USR4(VARPTR(VC(0,P+1,A)))
1860 'COPY (X(P+1,A),Y(P+1,A))-STEP(X(0,A),Y(0,A)),1 TO (X(1,A)+OX,Y(1,A)+OY),0
1870 RETURN
1880 '
1890 'BODY
1900 IF W(A)>0 THEN W(A)=W(A)-1:RETURN
1910 P=AP(A(A),A)'AP(A(A)+1+EF,A)
1920 GOSUB 1850
1930 A(A)=A(A)+1
1940 IF A(A)<(5-EF) THEN 1960
1950 A(A)=0:W(A)=RND(3)*(10-EF*16)
1960 RETURN
1970 '
1980 '
1990 'BUSTL
2000 IF (EF=0) THEN A(A)=3-A(2):W(A)=0
2010 IF W(A) THEN W(A)=W(A)-1:RETURN
2020 P=AP(A(A),A)
2030 GOSUB 1850
2040 A(A)=A(A)+1
2050 IF (A(A)<4) AND EF THEN RETURN
2060 A(A)=0:W(A)=RND(3)*30
2070 RETURN
2080 '
2090 'BUSTR
2100 IF W(A) THEN W(A)=W(A)-1:RETURN
2110 P=AP(A(A),A)
2120 GOSUB 1850
2130 IF A(A)<>2 THEN 2150
2140 IF EF THEN W(A)=RND(3)*3
2150 A(A)=A(A)+1
2160 IF A(A)<(3-EF-EF-EF) THEN 2180
2170 A(A)=0
2180 RETURN
2190 'BODY2
2200 IF W(A) THEN W(A)=W(A)-1:RETURN
2210 P=AP(A(A),A)
2220 GOSUB 1850
2230 A(A)=A(A)+1
2240 IF A(A)<2 THEN 2260
2250 A(A)=0:W(A)=RND(3)*(6-EF*14)
2260 RETURN
2270 '
2280 '
2290 'TIMER
2300 INTERVAL OFF
2310 TC=(TC+1)AND 255:IF TC AND 1 GOTO 2340
2320 U=USR3(0) 'TIME SPRITE
2330 TF=(TF+1)AND31
2340 INTERVAL ON
2350 RETURN
2360 '
2370 '
2380 'PALETTE +1
2390 PN=(PN+1)AND7
2400 GOTO 2430
2410 '
2420 '
2430 'PALETTE (PN=PALETTE NO)
2440 PJ=PN*16
2450 U=USR2(VARPTR(P(PJ)))
2460 RETURN
