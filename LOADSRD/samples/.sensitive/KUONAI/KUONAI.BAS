1000 COLOR 15,0,0:VDP(9)=VDP(9)AND253':VDP(9)=VDP(9)OR2
1010 CLEAR 200,&HB000:DEFINT A-Z:SC=5:A=RND(-TIME)
1020 SCREEN SC:DIM PL(255),SR(1,31)
1030 AM=4:DIM X(8,AM),Y(8,AM),A(AM),P(AM),W(AM),AP(15,AM),AF(AM),VC(7,8,AM)
1040 BM=15:VF=0:DIM VF(7,BM):FOR A=0 TO BM:VF(6,A)=0:VF(7,A)=&HD0:NEXT
1050 DEFUSR=&H156
1060 BLOAD"SRX.BIN"
1070 DEFUSR1=&HD000 'LOAD_SR
1080 DEFUSR2=&HD003 'SET_PAL
1090 DEFUSR3=&HD006 'TIMER SPRITE
1100 DEFUSR4=&HD009 'VDP COMMAND
1110 DEFUSR5=&HD00C 'VDP COMMAND WAIT
1120 F$="KUONAI":F$=LEFT$(F$+SPACE$(8),8)
1130 COPY F$+".PL"+HEX$(SC) TO PL
1140 FOR I=0TO7:PL(I*16)=33:NEXT
1150 PN=0:GOSUB 4140
1160 SETPAGE,2:CLS:SETPAGE,3:CLS
1170 SETPAGE0,1:A$=USR1(F$+".SR"+HEX$(SC)):SETPAGE0,0
1180 SCREEN,2:BLOAD"TIME.SPR",S,-(SC>6)*&H7800
1190 '
1200 'ÎÝÀ² ºËß° »· É »ÞË®³
1210 OX=32:OY=40:SX=0:SY=0:SW=192:SH=128:SP=256:BP=768:DX=OX-SX:DY=OY-SY
1220 '
1230 RESTORE 5440:XM=1-2*(SC<7)
1240 FOR I=0 TO AM
1250  READ X(0,I),Y(0,I)
1260  FOR J=1 TO 8
1270   READ X(J,I),Y(J,I)
1280   VC(0,J,I)=X(J,I):VC(1,J,I)=Y(J,I)+SP 'SX,SY
1290   VC(2,J,I)=X(1,I)+OX:VC(3,J,I)=Y(1,I)+OY+BP 'DX,DY
1300   VC(4,J,I)=X(0,I):VC(5,J,I)=Y(0,I) 'NX,NY
1310   VC(6,J,I)=0 'COLOR+ARG*SP
1320   L=(VC(0,J,I)OR VC(2,J,I)OR VC(4,J,I))AND XM
1330   IF L=0 THEN VC(7,J,I)=&HD0 'CMD HMMM
1340   IF L THEN VC(7,J,I)=&H90 'CMD lMMM
1350   'VC(7,J,I)=&H98 'CMD lMMM TPSET
1360  NEXT
1370  READ A$,B$
1380  FOR J=0 TO 15
1390   AP(J,I)=VAL(MID$(A$,J+1,1))
1400  NEXT
1410 NEXT
1420 '
1430 DIM VD(7,7),BD(7,7):FOR A=0 TO 7:BD(6,A)=0:BD(7,A)=&HD0:NEXT
1440 A=0:VD(0,A)=0:VD(1,A)=192+SP:VD(2,A)=0:VD(3,A)=112+BP:VD(4,A)=16:VD(5,A)=16:VD(6,A)=0:VD(7,A)=&H98:GOSUB 3210 'LMMM TPSET
1450 '
1460 'CLOCK
1470 FOR I=0 TO 7:PUTSPRITE I,(132+I*12,16),10,15:COLORSPRITE$(I)=STRING$(4,12)+STRING$(4,11):NEXT
1480 '
1490 'µÔ¼Þ É »ÞË®³
1500 KX=108:KY=142
1510 PUTSPRITE 9,(KX,KY),3,12
1520 PUTSPRITE 8,(KX,KY),5,13
1530 PUTSPRITE 31,(KX,KY+2),15,14
1540 DIM RY(2):SA=&HFA00+(SC<7)*&H8400:RY(2)=SA+4*31:RY(0)=SA+4*8:RY(1)=SA+4*9
1550 O1=52:O2=48:MF=56
1560 '
1570 ONINTERVAL=8 GOSUB 4020:GOSUB 4020
1580 '
1590 A$="t80l8s0m20000o5 ge-o4b-o5e- fb-4. fgfo4b-o5e-2"
1600 B$="t80l8v13o4 r4g4o5d4.o4f b-4 b-4 sm20000g2"
1610 PLAY A$,B$
1620 '
1630 'ÎÝÀ² ºËß°
1640 'COPY (SX,SY)-(SX+SW-1,SY+SH-1),1 TO (OX,OY),0
1650 A=6:VD(0,A)=SX:VD(1,A)=SY+SP:VD(2,A)=OX:VD(3,A)=OY+BP:VD(4,A)=SW:VD(5,A)=SH:VD(6,A)=0:VD(7,A)=&HD0 'HMMM
1660 A=7:VD(0,A)=OX:VD(1,A)=OY+BP:VD(2,A)=OX:VD(3,A)=OY:VD(4,A)=SW:VD(5,A)=SH:VD(6,A)=0:VD(7,A)=&HD0 'HMMM '&HE0 'YMMM
1670 A=6:GOSUB 3060:A=7:GOSUB 3060
1680 TM=TC:EF=((TM AND 32)>0)
1690 'VDP(26)=2
1700 '
1710 'MAIN LOOP
1720 'VS=(VS-1)AND255:VDP(27)=VS\8:VDP(28)=255-VS
1730 U=USR5(0):
1740 I$=INKEY$:A=USR(0)
1750 IF I$=" " THEN GOSUB 4100
1760 IF I$<>CHR$(13) THEN 1780
1770 O1=60+(O1=60)*8:O2=60+(O2=60)*12:VPOKE RY(0)+2,O1:VPOKE RY(1)+2,O2
1780 IF I$<>CHR$(11) THEN 1800
1790 MF=60+(MF=60)*4:VPOKE RY(2)+2,MF
1800 ' (ANIMATION)
1810 VPOKE RY(2),KY+TF+TF+2
1820 VPOKE RY(1),KY+TF+TF
1830 VPOKE RY(0),KY+TF+TF
1840 TM=TC:EF=((TM AND 32)>0)
1850 'IF TB=TM THEN 1980
1860 TB=TM
1870 TF=(TF+1)AND 3
1880 'IF PC THEN PC=0:GOSUB 2150 'ÊßÚ¯Ä +1
1890 '
1900 A=0:GOSUB 3090
1910 FOR A=0 TO 4:GOSUB 5010:NEXT
1920 '
1930 A=0:VD(0,A)=(VD(0,A)+16)AND 255:VD(2,A)=(VD(2,A)+1)AND 255
1940 A=0:GOSUB 3060:GOSUB 3250
1960 'IF VF THEN FOR A=0 TO VF-1:GOSUB 3120:NEXT:VF=0
1970 A=7:GOSUB 3070
1980 '
1990 GOTO 1710
2000 '
3000 '------ COPY IMAGE
3010 '
3020 ' COPY VC
3030 'COPY (X(P(A),A),Y(P(A),A))-STEP(X(0,A)-1,Y(0,A)-1),1 TO (X(1,A)+OX,Y(1,A)+OY),3:RETURN
3040 U=USR4(VARPTR(VC(0,P(A),A))):RETURN'GOTO 3210
3045 '
3050 ' COPY VD
3060 'COPY (VD(0,A),VD(1,A)AND255)-STEP(VD(4,A)-1,VD(5,A)-1),VD(1,A)\256 TO (VD(2,A),VD(3,A)AND255),VD(3,A)\256:RETURN
3070 U=USR4(VARPTR(VD(0,A))):RETURN'GOTO 3250
3075 '
3080 ' COPY BD
3090 'COPY (BD(0,A),BD(1,A)AND255)-STEP(BD(4,A)-1,BD(5,A)-1),BD(1,A)\256 TO (BD(2,A),BD(3,A)AND255),BD(3,A)\256:RETURN
3100 U=USR4(VARPTR(BD(0,A))):RETURN'GOTO 3290
3105 '
3110 ' COPY VF
3120 'COPY (VF(0,A),VF(1,A)AND255)-STEP(VF(4,A)-1,VF(5,A)-1),VF(1,A)\256 TO (VF(2,A),VF(3,A)AND255),VF(3,A)\256:RETURN
3130 U=USR4(VARPTR(VF(0,A))):RETURN
3190 '
3200 ' param set VC to VF
3210 VF(0,VF)=VC(2,P(A),A):VF(1,VF)=VC(3,P(A),A):VF(2,VF)=VC(2,P(A),A):VF(3,VF)=VC(3,P(A),A)AND 255:VF(4,VF)=VC(4,P(A),A):VF(5,VF)=VC(5,P(A),A):VF(7,VF)=VC(7,P(A),A)AND &HF0:VF=VF+1:RETURN
3215 '
3240 ' param set VD to BD & VF
3260 VF(0,VF)=VD(2,A):VF(1,VF)=VD(3,A):VF(2,VF)=VD(2,A):VF(3,VF)=VD(3,A)AND 255:VF(4,VF)=VD(4,A):VF(5,VF)=VD(5,A):VF(7,VF)=VD(7,A)AND &HF0:VF=VF+1
3250 BD(0,A)=VD(2,A)-DX:BD(1,A)=(VD(3,A)AND 255)-DY+SP:BD(2,A)=VD(2,A):BD(3,A)=(VD(3,A)AND 255)+BP:BD(4,A)=VD(4,A):BD(5,A)=VD(5,A):BD(7,A)=VD(7,A)AND &HF0:RETURN
3270 '
3280 ' param set BD to VF
3290 VF(0,VF)=BD(2,A):VF(1,VF)=BD(3,A):VF(2,VF)=BD(2,A):VF(3,VF)=BD(3,A)AND 255:VF(4,VF)=BD(4,A):VF(5,VF)=BD(5,A):VF(7,VF)=BD(7,A)AND &HF0:VF=VF+1:RETURN
3990 '
4010 '
4020 'TIMER
4030 INTERVAL OFF
4040 TC=(TC+1)AND 2047':IF (TC AND 255)= 0 THEN PC=1
4050 IF TC AND 3 THEN 4070
4060 U=USR3(0) 'TIME SPRITE
4070 INTERVAL ON
4080 RETURN
4090 '
4100 'PALETTE +1
4110 PN=(PN+1)AND7
4120 GOTO 4140
4130 '
4140 'PALETTE (PN=PALETTE NO)
4150 PJ=PN*16
4160 U=USR2(VARPTR(PL(PJ)))
4170 RETURN
4180 '
5000 '-------SUB COMMON END
5010 ON A+1 GOTO 5040,5120,5200,5280,5360:RETURN
5020 '
5030 'EYES
5040 P(A)=AP(A(A),A):GOSUB 3030
5050 IF W(A)>0 THEN W(A)=W(A)-1:RETURN
5060 A(A)=(A(A)+1) AND 15
5070 IF (A(A)AND 7)<>0 THEN 5090
5080 A(A)=-5*(RND(3)*10<8):W(A)=RND(3)*3
5090 RETURN
5100 '
5110 'MOUTH
5120 P(A)=AP(A(A),A):GOSUB 3030
5130 IF W(A) THEN W(A)=W(A)-1:RETURN
5140 A(A)=(A(A)+1)AND 15
5150 IF (A(A) AND 7)<>0 THEN 5170
5160 A(A)=-5*(RND(3)*10<2):W(A)=RND(3)*3
5170 RETURN
5180 '
5190 'BUSTR
5200 P(A)=AP(A(A),A):GOSUB 3030
5210 IF W(A) THEN W(A)=W(A)-1:RETURN
5220 A(A)=A(A)+1
5230 IF A(A)<4 THEN 5250
5240 A(A)=0:W(A)=RND(3)*(10-EF*20)
5250 RETURN
5260 '
5270 'BUSTL
5280 P(A)=AP(A(A),A):GOSUB 3030
5290 IF W(A) THEN W(A)=W(A)-1:RETURN
5300 A(A)=A(A)+1
5310 IF A(A)<4 THEN 5330
5320 A(A)=0:W(A)=RND(3)*(10-EF*20)
5330 RETURN
5340 '
5350 'HIP
5360 P(A)=AP(A(A),A):GOSUB 3030
5370 IF W(A) THEN W(A)=W(A)-1:RETURN
5380 A(A)=A(A)+1
5390 IF A(A)<4 THEN 5410
5400 A(A)=0:W(A)=10+RND(3)*60
5410 RETURN
5420 '
5430 '     SIZE     ORG     ANIME1,2,3,4,5,6,7(X,Y)
5440 DATA  24,20,   40,45,  0,128,   24,128,  48,128, 72,128, 0,0, 0,0, 0,0
5450 DATA "12310...40......","EYE"
5460 DATA  16,12,   44,80,  192,96,  208,96,  224,96, 240,96, 0,0, 0,0, 0,0
5470 DATA "120.....320.....","MOUTH"
5480 DATA  52,32,   24,96,  192,0,   192,32,  0,0, 0,0, 0,0, 0,0, 0,0
5490 DATA "1210............","BUSTR"
5500 DATA  68,54,   76,68,  112,132, 184,132, 0,0, 0,0, 0,0, 0,0, 0,0
5510 DATA "1210............","BUSTL"
5520 DATA  28,28,  164, 0,  196,64,  228,64, 0,0, 0,0, 0,0, 0,0, 0,0
5530 DATA "1210............","HIP"
5540 '
5550 ' MOVIN
5560 '
5570 '------ COMMON
