1000 COLOR 15,13,0:VDP(9)=VDP(9)AND253':VDP(9)=VDP(9)OR2
1010 CLEAR 200,&HB000:DEFINT A-Z:SC=5:A=RND(-TIME)
1020 SCREEN SC
1030 FOR I=0TO14:COLOR=(I,0,0,0):NEXT
1040 AM=4:DIM A(AM),P(AM),W(AM),AP(15,AM),VC(7,8,AM)
1050 DEFUSR=&H156
1060 BLOAD"SRX2.BIN"
1070 DEFUSR1=&HD000 'LOAD_SR
1080 DEFUSR2=&HD003 'SET_PAL
1090 DEFUSR3=&HD006 'TIMER SPRITE
1100 DEFUSR4=&HD009 'VDP COMMAND
1110 DEFUSR5=&HD00C 'VDP COMMAND WAIT
1120 DEFUSR6=&HD00F 'SET SPRITE
1130 DEFUSR7=&HD012 'SET SPRITE COLOR
1131 DEFUSR8=&HD015 'SET SPRITE INTERRUPT
1132 U=USR8(0)
1133 ON STOP GOSUB 1134:STOP ON:ON ERROR GOTO 1134:GOTO 1140
1134 U=USR8(-1):STOPOFF:ONERRORGOTO0:END 'revove timer hook
1140 F$="KUONAI":F$=LEFT$(F$+SPACE$(8),8)
1150 DIM PL(255):COPY F$+".PL"+HEX$(SC) TO PL
1160 PL(0)=33:FOR I=1 TO 7:FOR J=0 TO 15:A=I*32+J*2:B=PL(A-32)\16:R=PL(A-32)AND15:G=PL(A-31):B=(B-1)*-(B>0):R=(R-1)*-(R>0):G=(G-1)*-(G>0):PL(A)=B*16+R:PL(A+1)=G:NEXT:NEXT
1170 SETPAGE,2:CLS:SETPAGE,3:CLS
1180 SETPAGE0,1:A$=USR1(F$+".SR"+HEX$(SC)):SETPAGE0,0
1190 SCREEN,3:BLOAD"KUONAI.SPR",S,-(SC>6)*&H7800
1200 DIM SC(16*64):COPY"KUONAI.SPC"TO SC:U=USR7(VARPTR(SC(0))):ERASE SC
1201 U=USR8(0) 'set VSYNC sprite hook
1210 '
1220 'ÎÝÀ² ºËß° »· É »ÞË®³
1230 OX=32:OY=40:SX=0:SY=0:SW=192:SH=128:SP=256:BP=768*0:DX=OX-SX:DY=OY-SY
1240 '
1250 RESTORE 3020:XM=1-2*(SC<7)
1260 DIM CX(8,AM),CY(8,AM)
1270 FOR I=0 TO AM
1280  READ CX(0,I),CY(0,I)
1290  FOR J=1 TO 8
1300   READ CX(J,I),CY(J,I)
1310   VC(0,J,I)=CX(J,I):VC(1,J,I)=CY(J,I)+SP 'SX,SY
1320   VC(2,J,I)=CX(1,I)+OX:VC(3,J,I)=CY(1,I)+OY+BP 'DX,DY
1330   VC(4,J,I)=CX(0,I):VC(5,J,I)=CY(0,I) 'NX,NY
1340   VC(6,J,I)=0 'COLOR+ARG*SP
1350   L=(VC(0,J,I)OR VC(2,J,I)OR VC(4,J,I))AND XM
1360   IF L=0 THEN VC(7,J,I)=&HD0 'CMD HMMM
1370   IF L THEN VC(7,J,I)=&H90 'CMD lMMM
1380   'VC(7,J,I)=&H98 'CMD lMMM TPSET
1390  NEXT
1400  READ A$,B$
1410  FOR J=0 TO 15
1420   AP(J,I)=VAL(MID$(A$,J+1,1))
1430  NEXT
1440 NEXT
1450 ERASE CX,CY
1460 '
1470 DIM VD(7,7)
1480 A=0:VD(0,A)=0:VD(1,A)=192+SP:VD(2,A)=0:VD(3,A)=112+BP:VD(4,A)=16:VD(5,A)=16:VD(6,A)=0:VD(7,A)=&H98 'LMMM TPSET
1490 '
1500 DIM SR(4*32-1),S(31),X(8),Y(8),VX(8),VY(8)
1510 FORI=0TO31:S(I)=I*4:SR(S(I)+3)=-1:NEXT
1520 '
1530 'CLOCK
1540 FOR I=0 TO 7:J=I*4
1550  'PUTSPRITE I,(132+I*12,16),2,15
1560  'COLORSPRITE$(I)=STRING$(4,10)+STRING$(4,12)
1570  SR(J)=(212-32)*2:SR(J+1)=(128+I*16)*2:SR(J+2)=15:SR(J+3)=0
1580 NEXT
1590 LINE(0,192)-(255,211),0,BF
1600 '
1610 '·¬×
1620 MY=(212-32)*2'192-16'176
1630 LX=(-32)*2:MX=255*2
1640 X0=108*2:V0=2+RND(3)*3:Y0=MY-32:W0=-2-RND(3)*20
1650 N=8 :X=X0:Y=Y0:P=16:F=4:GOSUB 1780
1660 X1=10*2:V1=-2-RND(3)*3:Y1=MY-32:W1=-2-RND(3)*20
1670 N=10:X=X1:Y=Y1:P=24:F=4:GOSUB 1780
1680 X2=RND(3)*240*2:V2=8-RND(3)*16*2:Y2=MY:W2=4-RND(3)*8
1690 N=12:X=X2:Y=Y2:P=32:F=&H14:GOSUB 1780
1700 X3=RND(3)*240*2:V3=8-RND(3)*16*2:Y3=MY-64:W3=4-RND(3)*8
1710 N=14:X=X3:Y=Y3:P=40:F=&H14:GOSUB 1780
1720 X4=RND(3)*240*2:V4=8-RND(3)*16*2:Y4=MY-76:W4=4-RND(3)*8
1730 N=16:X=X4:Y=Y4:P=48:F=&H14:GOSUB 1780
1740 X5=RND(3)*240*2:V5=8-RND(3)*16*2:Y5=MY-64:W5=4-RND(3)*8
1750 N=18:X=X5:Y=Y5:P=56:F=&H12:GOSUB 1780
1760 GOTO 1820
1770 '
1780 J=S(N+0):SR(J)=Y:SR(J+1)=X:SR(J+2)=P+0:SR(J+3)=F
1790 J=S(N+1):SR(J)=Y:SR(J+1)=X:SR(J+2)=P+1:SR(J+3)=F
1800 RETURN
1810 '
1820 ONINTERVAL=8 GOSUB 2450:GOSUB 2450
1830 '
1840 A$="t80l8s0m20000o5 ge-o4b-o5e- fb-4. fgfo4b-o5e-2"
1850 B$="t80l8v13o4 r4g4o5d4.o4f b-4 b-4 sm20000g2"
1860 PLAY A$,B$
1870 '
1880 FORI=0TO7:J=(7-I)*32:U=USR2(VARPTR(PL(J))):NEXT
1890 '
1900 'ÎÝÀ² ºËß°
1910 'COPY (SX,SY)-(SX+SW-1,SY+SH-1),1 TO (OX,OY),0
1920 A=6:VD(0,A)=SX:VD(1,A)=SY+SP:VD(2,A)=OX:VD(3,A)=OY+BP:VD(4,A)=SW:VD(5,A)=SH:VD(6,A)=0:VD(7,A)=&HD0 'HMMM
1930 A=6:GOSUB 2420
1940 TM=TC:EF=((TM AND 32)>0)
1950 'VDP(26)=2
1960 '
1970 'MAIN LOOP
1980 I$=INKEY$:A=USR(0)
1990 ' (ANIMATION)
2000 SR(32)=Y0:SR(36)=Y0:SR(33)=X0:SR(37)=X0'8*4=32
2010 SR(40)=Y1:SR(44)=Y1:SR(41)=X1:SR(45)=X1
2020 SR(48)=Y2:SR(52)=Y2:SR(49)=X2:SR(53)=X2
2030 SR(56)=Y3:SR(60)=Y3':SR(57)=X3:SR(61)=X3
2040 SR(64)=Y4:SR(68)=Y4':SR(65)=X4:SR(69)=X4
2050 SR(72)=Y5:SR(76)=Y5':SR(73)=X5:SR(77)=X5
2060 '
2070  'Y0=Y0+W0:W0=W0+1:IF Y0>MY THEN Y0=MY:W0=-8-RND(3)*16
2080  X0=X0+V0:IF(X0<LX)OR(X0>MX)THEN X0=X0-V0:V0=-V0
2090 '
2100  'Y1=Y1+W1:W1=W1+1:IF Y1>MY THEN Y1=MY:W1=-8-RND(3)*16
2110  X1=X1+V1:IF(X1<LX)OR(X1>MX)THEN X1=X1-V1:V1=-V1
2120 '
2130  'Y2=Y2+W2:W2=W2+1:IF Y2>MY THEN Y2=MY:W2=-8-RND(3)*16
2140  X2=X2+V2:IF(X2<LX)OR(X2>MX)THEN X2=X2-V2:V2=-V2
2150 '
2160  'Y3=Y3+W3:W3=W3+1:IF Y3>MY THEN Y3=MY:W3=-8-RND(3)*16
2170  X3=X3+V3:IF(X3<LX)OR(X3>MX)THEN X3=X3-V3:V3=-V3
2180 '
2190  'Y4=Y4+W4:W4=W4+1:IF Y4>MY THEN Y4=MY:W4=-8-RND(3)*16
2200  X4=X4+V4:IF(X4<LX)OR(X4>MX)THEN X4=X4-V4:V4=-V4
2210 '
2220  'Y5=Y5+W5:W5=W5+1:IF Y5>MY THEN Y5=MY:W5=-8-RND(3)*16
2230  X5=X5+V5:IF(X5<LX)OR(X5>MX)THEN X5=X5-V5:V5=-V5
2240 '
2260 U=USR6(VARPTR(SR(0)))
2270 TM=TC:EF=((TM AND 64)>0)
2280 'IF TB=TM THEN 1980
2290 TB=TM
2300 TF=(TF+1)AND 7
2310 '
2320 FOR A=0 TO 4:GOSUB 2590:NEXT
2330 '
2340 GOTO 1980
2350 '
2360 '------ COMMON
2370 '
2380 ' COPY VC
2390 U=USR4(VARPTR(VC(0,P(A),A))):RETURN
2400 '
2410 ' COPY VD
2420 U=USR4(VARPTR(VD(0,A))):RETURN
2430 '
2440 'TIMER
2450 INTERVAL OFF
2460 TC=(TC+1)AND 2047
2470 IF TC AND 3 THEN 2500
2480 U=USR3(0) 'TIME SPRITE
2490 FOR TI=0 TO 7:SR(S(TI)+2)=PEEK(U+TI):NEXT
2500 INTERVAL ON
2510 RETURN
2520 '
2530 'PALETTE (PN=PALETTE NO)
2540 PJ=PN*16
2550 U=USR2(VARPTR(PL(PJ)))
2560 RETURN
2570 '
2580 '------- CUSTOMIZE
2590 ON A+1 GOTO 2620,2700,2780,2860,2940:RETURN
2600 '
2610 'EYES
2620 IF W(A) THEN W(A)=W(A)+(W(A)>0):RETURN
2630 P(A)=AP(A(A),A):GOSUB 2390
2640 A(A)=(A(A)+1) AND 15
2650 IF (A(A)AND 7)<>0 THEN 2670
2660 A(A)=-5*(RND(3)*10<8):W(A)=RND(3)*3
2670 RETURN
2680 '
2690 'MOUTH
2700 IF W(A) THEN W(A)=W(A)+(W(A)>0):RETURN
2710 P(A)=AP(A(A),A):GOSUB 2390
2720 A(A)=(A(A)+1)AND 15
2730 IF (A(A) AND 7)<>0 THEN 2750
2740 A(A)=-5*(RND(3)*10<2):W(A)=RND(3)*3
2750 RETURN
2760 '
2770 'BUSTR
2780 IF W(A) THEN W(A)=W(A)+(W(A)>0):RETURN
2790 P(A)=AP(A(A),A):GOSUB 2390
2800 A(A)=A(A)+1
2810 IF A(A)<4 THEN 2830
2820 A(A)=0:W(A)=RND(3)*(10-EF*20)
2830 RETURN
2840 '
2850 'BUSTL
2860 IF W(A) THEN W(A)=W(A)+(W(A)>0):RETURN
2870 P(A)=AP(A(A),A):GOSUB 2390
2880 A(A)=A(A)+1
2890 IF A(A)<4 THEN 2910
2900 A(A)=0:W(A)=RND(3)*(10-EF*20)
2910 RETURN
2920 '
2930 'HIP
2940 IF W(A) THEN W(A)=W(A)+(W(A)>0):RETURN
2950 P(A)=AP(A(A),A):GOSUB 2390
2960 A(A)=A(A)+1
2970 IF A(A)<4 THEN 2990
2980 A(A)=0:W(A)=10+RND(3)*60
2990 RETURN
3000 '
3010 '     SIZE     ORG     ANIME1,2,3,4,5,6,7(X,Y)
3020 DATA  24,20,   40,45,  0,128,   24,128,  48,128, 72,128, 0,0, 0,0, 0,0
3030 DATA "12310...40......","EYE"
3040 DATA  16,12,   44,80,  192,96,  208,96,  224,96, 240,96, 0,0, 0,0, 0,0
3050 DATA "120.....320.....","MOUTH"
3060 DATA  52,32,   24,96,  192,0,   192,32,  0,0, 0,0, 0,0, 0,0, 0,0
3070 DATA "1210............","BUSTR"
3080 DATA  68,54,   76,68,  112,132, 184,132, 0,0, 0,0, 0,0, 0,0, 0,0
3090 DATA "1210............","BUSTL"
3100 DATA  28,28,  164, 0,  196,64,  228,64, 0,0, 0,0, 0,0, 0,0, 0,0
3110 DATA "1210............","HIP"
3120 '
3130 ' MOVIN
3140 '
3150 '------ COMMON
