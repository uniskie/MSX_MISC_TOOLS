1000 COLOR 15,0,0:VDP(9)=VDP(9)AND253':VDP(9)=VDP(9)OR2
1010 '
1020 CLEAR 200,&HB000:DEFINT A-Z:SC=5:AM=4:A=RND(-TIME)
1030 DIM P(255),X(8,AM),Y(8,AM),A(AM),W(AM),AP(15,AM),AF(AM),VC(8,8,AM),SR(1,31)
1040 SCREEN SC:DEFUSR=&H156
1050 BLOAD"SRX.BIN"
1060 DEFUSR1=&HD000 'LOAD_SR
1070 DEFUSR2=&HD003 'SET_PAL
1080 DEFUSR3=&HD006 'TIMER SPRITE
1090 DEFUSR4=&HD009 'VDP COMMAND
1100 DEFUSR5=&HD00C 'VDP COMMAND WAIT
1110 F$="KUONAI":F$=LEFT$(F$+SPACE$(8),8)
1120 COPY F$+".PL"+HEX$(SC) TO P
1130 FOR I=0TO7:P(I*16)=33:NEXT
1140 PN=0:GOSUB 2190
1145 SETPAGE,2:CLS:SETPAGE,3:CLS
1150 SETPAGE0,1:A$=USR1(F$+".SR"+HEX$(SC)):SETPAGE0,0
1160 SCREEN,2:BLOAD"TIME.SPR",S,-(SC>6)*&H7800
1170 '
1180 'ÎÝÀ² ºËß° »· É »ÞË®³
1190 OX=32:OY=40:SX=0:SY=0:SW=192:SH=128:SP=256:BP=768*0:DX=OX-SX:DY=OY-SY
1200 '
1210 RESTORE 4010:XM=1-2*(SC<7)
1220 FOR I=0 TO AM
1230  READ X(0,I),Y(0,I)
1240  FOR J=1 TO 8
1250   READ X(J,I),Y(J,I)
1260   VC(0,J,I)=X(J,I):VC(1,J,I)=Y(J,I)+SP 'SX,SY
1270   VC(2,J,I)=X(1,I)+OX:VC(3,J,I)=Y(1,I)+OY+BP 'DX,DY
1280   VC(4,J,I)=X(0,I):VC(5,J,I)=Y(0,I) 'NX,NY
1290   VC(6,J,I)=0 'COLOR+ARG*SP
1300   L=(VC(0,J,I)OR VC(2,J,I)OR VC(4,J,I))AND XM
1310   IF L=0 THEN VC(7,J,I)=&HD0 'CMD HMMM
1320   IF L THEN VC(7,J,I)=&H90 'CMD lMMM
1330   'VC(7,J,I)=&H98 'CMD lMMM TPSET
1340  NEXT
1350  READ A$,B$
1360  FOR J=0 TO 15
1370   AP(J,I)=VAL(MID$(A$,J+1,1))
1380  NEXT
1390 NEXT
1400 '
1410 DIM VD(7,7),BD(7,7):FOR I=0 TO7:BD(6,I)=0:BD(7,I)=&HD0:NEXT
1430 I=0:VD(0,I)=0:VD(1,I)=192+SP:VD(2,I)=0:VD(3,I)=112+BP:VD(4,I)=16:VD(5,I)=16:VD(6,I)=0:VD(7,I)=&H98:GOSUB 2058 'LMMM TPSET
1440 '
1450 'CLOCK
1460 FOR I=0 TO 7:PUTSPRITE I,(132+I*12,16),10,15:COLORSPRITE$(I)=STRING$(4,12)+STRING$(4,11):NEXT
1470 'µÔ¼Þ É »ÞË®³
1480 KX=108:KY=142
1490 PUTSPRITE 9,(KX,KY),3,12
1500 PUTSPRITE 8,(KX,KY),5,13
1510 PUTSPRITE 31,(KX,KY+2),15,14
1515 DIM SY(2):SA=&HFA00+(SC<7)*&H8400:SY(2)=SA+4*31:SY(0)=SA+4*8:SY(1)=SA+4*9
1520 O1=52:O2=48:MF=56
1530 '
1540 ONINTERVAL=8 GOSUB 2070:GOSUB 2070
1550 '
1560 A$="t80l8s0m20000o5 ge-o4b-o5e- fb-4. fgfo4b-o5e-2"
1570 B$="t80l8v13o4 r4g4o5d4.o4f b-4 b-4 sm20000g2"
1580 PLAY A$,B$
1590 '
1600 'ÎÝÀ² ºËß°
1610 'COPY (SX,SY)-(SX+SW-1,SY+SH-1),1 TO (OX,OY),0
1612 I=6:VD(0,I)=SX:VD(1,I)=SY+SP:VD(2,I)=OX:VD(3,I)=OY+BP:VD(4,I)=SW:VD(5,I)=SH:VD(6,I)=0:VD(7,I)=&HD0 'HMMM
1613 I=7:VD(0,I)=OX:VD(1,I)=OY+BP:VD(2,I)=OX:VD(3,I)=OY:VD(4,I)=SW:VD(5,I)=SH:VD(6,I)=0:VD(7,I)=&HD0 'HMMM '&HE0 'YMMM
1614 I=6:GOSUB 2050
1620 TM=TC:EF=((TM AND 32)>0)
1630 'VDP(26)=2
1640 '
1650 'MAIN LOOP
1660 'VS=(VS-1)AND255:VDP(27)=VS\8:VDP(28)=255-VS
1670 'U=USR5(0):
1671 I$=INKEY$:A=USR(0)
1680 IF I$=" " THEN GOSUB 2150
1690 IF I$<>CHR$(13) THEN 1710
1700 O1=60+(O1=60)*8:O2=60+(O2=60)*12:VPOKE SY(0)+2,O1:VPOKE SY(1)+2,O2
1710 IF I$<>CHR$(11) THEN 1730
1720 MF=60+(MF=60)*4:VPOKE SY(2)+2,MF
1730 ' (ANIMATION)
1740 VPOKE SY(2),KY+TF+TF+2
1750 VPOKE SY(1),KY+TF+TF
1760 VPOKE SY(0),KY+TF+TF
1770 TM=TC:EF=((TM AND 32)>0)
1780 'IF TB=TM THEN 1970
1790 TB=TM
1800 TF=(TF+1)AND 3
1810 'IF PC THEN PC=0:GOSUB 2150 'ÊßÚ¯Ä +1
1819 '
1820 'I=0:GOSUB 2055
1829 '
1830 A=3:GOSUB 3000
1840 A=2:GOSUB 3000
1850 A=1:GOSUB 3000
1860 A=0:GOSUB 3000
1870 A=4:GOSUB 3000
1880 '
1890 'I=0:VD(0,I)=(VD(0,I)+16)AND 255:VD(2,I)=(VD(2,I)+1)AND 255
1900 'I=0:GOSUB 2050
1910 'I=7:GOSUB 2050
1960 'I=0:GOSUB 2058
1970 '
1980 GOTO 1650
1990 '
2000 '------ SUB COMMON
2010 '
2020 ' COPY
2030 'COPY (X(P+1,A),Y(P+1,A))-STEP(X(0,A)-1,Y(0,A)-1),1 TO (X(1,A)+OX,Y(1,A)+OY),3:RETURN
2031 U=USR4(VARPTR(VC(0,P+1,A))):RETURN
2040 ' COPY 2
2050 'COPY (VD(0,I),VD(1,I)AND255)-STEP(VD(4,I)-1,VD(5,I)-1),VD(1,I)\256 TO (VD(2,I),VD(3,I)AND255),VD(3,I)\256:RETURN
2051 U=USR4(VARPTR(VD(0,I))):RETURN
2054 ' COPY3
2055 U=USR4(VARPTR(BD(0,I))):RETURN
2057 ' param set
2058 BD(0,I)=VD(2,I)-DX:BD(1,I)=(VD(3,I)AND 255)-DY+SP:BD(2,I)=VD(2,I):BD(3,I)=(VD(3,I)AND 255)+BP:BD(4,I)=VD(4,I):BD(5,I)=VD(5,I):RETURN'BD(6,I)=VD(6,I):BD(7,I)=&HD0 'HMMM
2059 RETURN
2060 '
2070 'TIMER
2080 INTERVAL OFF
2090 TC=(TC+1)AND 2047':IF (TC AND 255)= 0 THEN PC=1
2100 IF TC AND 3 THEN 2120
2110 U=USR3(0) 'TIME SPRITE
2120 INTERVAL ON
2130 RETURN
2140 '
2150 'PALETTE +1
2160 PN=(PN+1)AND7
2170 GOTO 2190
2180 '
2190 'PALETTE (PN=PALETTE NO)
2200 PJ=PN*16
2210 U=USR2(VARPTR(P(PJ)))
2220 RETURN
2230 '
2990 '-------SUB COMMON END
3000 ON A+1 GOTO 3020,3110,3210,3320,3410:RETURN
3009 '
3010 'EYES
3020 IF W(A)>0 THEN W(A)=W(A)-1:RETURN
3030 A(A)=(A(A)+1) AND 15
3040 P=AP(A(A),A):GOSUB 2030
3060 IF (A(A)AND 7)<>0 THEN 3080
3070 A(A)=-5*(RND(3)*10<8):W(A)=RND(3)*3
3080 RETURN
3090 '
3100 'MOUTH
3110 IF W(A) THEN W(A)=W(A)-1:RETURN
3120 A(A)=(A(A)+1)AND 15
3130 P=AP(A(A),A):GOSUB 2030
3150 IF (A(A) AND 7)<>0 THEN 3180
3170 A(A)=-5*(RND(3)*10<2):W(A)=RND(3)*3
3180 RETURN
3190 '
3200 'BUSTR
3210 IF W(A) THEN W(A)=W(A)-1:RETURN
3220 A(A)=A(A)+1
3230 P=AP(A(A),A):GOSUB 2030
3270 IF A(A)<4 THEN 3290
3280 A(A)=0:W(A)=RND(3)*(10-EF*20)
3290 RETURN
3300 '
3310 'BUSTL
3320 IF W(A) THEN W(A)=W(A)-1:RETURN
3330 A(A)=A(A)+1
3340 P=AP(A(A),A):GOSUB 2030
3360 IF A(A)<4 THEN 3380
3370 A(A)=0:W(A)=RND(3)*(10-EF*20)
3380 RETURN
3390 '
3400 'HIP
3410 IF W(A) THEN W(A)=W(A)-1:RETURN
3420 A(A)=A(A)+1
3430 P=AP(A(A),A):GOSUB 2030
3450 IF A(A)<4 THEN 3470
3460 A(A)=0:W(A)=10+RND(3)*60
3470 RETURN
3490 '
4000 '     SIZE     ORG     ANIME1,2,3,4,5,6,7(X,Y)
4010 DATA  24,20,   40,45,  0,128,   24,128,  48,128, 72,128, 0,0, 0,0, 0,0
4020 DATA "12310...40......","EYE"
4030 DATA  16,12,   44,80,  192,96,  208,96,  224,96, 240,96, 0,0, 0,0, 0,0
4040 DATA "120.....320.....","MOUTH"
4050 DATA  52,32,   24,96,  192,0,   192,32,  0,0, 0,0, 0,0, 0,0, 0,0
4060 DATA "1210............","BUSTR"
4070 DATA  68,54,   76,68,  112,132, 184,132, 0,0, 0,0, 0,0, 0,0, 0,0
4090 DATA "1210............","BUSTL"
4100 DATA  28,28,  164, 0,  196,64,  228,64, 0,0, 0,0, 0,0, 0,0, 0,0
4110 DATA "1210............","HIP"
