1000 CLEAR 200,&HB000:DEFINT A-Z
1010 DIM P(255),W(3):W(0)=0
1020 '
1030 F$="JTHUNDEM"
1040 '
1050 E$=LEFT$(RIGHT$(F$,3),2)
1060 SR=(E$="SR")OR(E$="sr")'OR(E$="Sr")OR(E$="sR")
1070 '
1080 COLOR 15,0,0:VDP(9)=VDP(9)AND253
1090 SCREEN7:DEFUSR=&H156
1100 BLOAD"LOADSRD.BOF"
1110 DEFUSR1=&HD000 'LOAD_SR
1120 DEFUSR2=&HD003 'SET_PAL
1130 DEFUSR3=&HD006 'TIMER SPRITE
1140 DEFUSR4=&HD009 'VDP COMMAND
1150 DEFUSR5=&HD00C 'VDP COMMAND WAIT
1160 SCREEN,3:BLOAD"TIME.SPR",S,&H7800
1170 '
1180 IF SR THEN COPY F$+".PL7" TO P:PN=0:GOSUB 2190
1190 SETPAGE0,1:A$=USR1(F$+".SR7"):SETPAGE0,0
1200 IF SR=0 THEN SETPAGE,1:COLOR=RESTORE:SETPAGE,0
1210 '
1220 'Ä¹² É Ë®³¼Þ
1230 CX=128:CY=1
1240 FOR I=0 TO 7:PUTSPRITE I,(CX+I*16,CY),2,15:COLORSPRITE$(I)=STRING$(4,4)+STRING$(4,3):NEXT
1250 '
1260 'µÔ¼Þ É Ë®³¼Þ
1270 KX=34:KY=124
1280 PUTSPRITE 9,(KX,KY),13,12
1290 PUTSPRITE 8,(KX,KY),7,13
1300 PUTSPRITE 31,(KX,KY+2),15,14
1310 O1=52:O2=48:MF=56
1320 '
1330 ONINTERVAL=4 GOSUB 2070:GOSUB 2070
1340 '
1350 'ÎÝÀ² Ë®³¼Þ
1360 OX=0:OY=0:OW=251:OH=212:SX=0:SY=0:EX=SX+OW-1:EY=SY+OH-1
1370 LM=32:DX=4:MX=(DX-1):FW=OW\DX:FH=OH/(LM\DX)
1380 DIM LF(LM),VC(8):HT=0:LF=1
1390 VC(4)=FW+1:VC(5)=FH+1:VC(6)=0:VC(7)=&HD0
1400 'COPY (SX,SY)-(EX,EY),1 TO (OX,OY),0
1410 TM=TC:EF=((TM AND 16)>0)
1420 'VDP(26)=2
1430 '
1440 'MAIN LOOP
1450 'VS=(VS-1)AND255:VDP(27)=VS\8:VDP(28)=255-VS
1460 I$=INKEY$:A=USR(0)
1470 IF I$=CHR$(9) THEN W(0)=0
1480 IF I$=" " THEN GOSUB 2150
1490 IF I$<>CHR$(13) THEN 1510
1500 O1=60+(O1=60)*8:O2=60+(O2=60)*12:VPOKE -1502,O1:VPOKE -1498,O2
1510 IF I$<>CHR$(11) THEN 1530
1520 MF=60+(MF=60)*4:VPOKE -1410,MF
1530 ' (ANIMATION)
1540 VPOKE -1412,KY+TF+TF+2
1550 VPOKE -1504,KY+TF+TF
1560 VPOKE -1500,KY+TF+TF
1570 TB=TM
1580 TM=TC:EF=((TM AND 16)>0)
1590 IF TB=TM THEN 1440
1600 IF EF THEN GOSUB 2150 'ÊßÚ¯Ä +1
1610 A=0:GOSUB 3010
1620 GOTO 1440
1630 '
2000 '------ SUB COMMON
2010 '
2020 ' COPY
2030 U=USR4(VARPTR(VC(0,P+1,A)))
2040 'COPY (X(P+1,A),Y(P+1,A))-STEP(X(0,A),Y(0,A)),1 TO (X(1,A)+OX,Y(1,A)+OY),0
2050 RETURN
2060 '
2070 'TIMER
2080 INTERVAL OFF
2090 TC=(TC+1)AND 255:IF TC AND 3 THEN 2120
2100 U=USR3(0) 'TIME SPRITE
2110 TF=(TF+1)AND3
2120 INTERVAL ON
2130 RETURN
2140 '
2150 'PALETTE +1
2160 PN=(PN+1)AND7
2170 GOTO 2190
2180 '
2190 'PALETTE (PN=PALETTE NO)
2200 IF SR=0 THEN RETURN
2210 PJ=PN*16:U=USR2(VARPTR(P(PJ)))
2220 RETURN
2230 '
2990 '-------SUB COMMON END
3000 '
3010 'FADE IN
3020 IF W(A) THEN W(A)=W(A)-1:RETURN
3030 L=12:LI=LN
3040 LI=-LI*(LI<LM):IF (LF(LI)=LF) AND (L>0) THEN L=L-1:LI=LI+1:GOTO 3040
3050 IF LF(LI)=LF THEN LN=LI:GOTO 3090 ELSE LN=RND(4)*LM
3060 HT=HT+1:LF(LI)=LF:FX=(LI AND MX)*FW:FY=(LI\DX)*FH:AX=SX+FX:AY=SY+FY
3070 VC(0)=AX:VC(1)=AY+256:VC(2)=OX+FX:VC(3)=OY+FY:U=USR4(VARPTR(VC(0)))
3080 'COPY(AX,AY)-(AX+FW,AY+FH),1TO(OX+FX,OY+FY),0
3090 W(A)=0'3+RND(3)
3100 IF HT>=LM THEN HT=0:LF=1-LF:SX=511-EX-SX:W(A)=150+RND(3)*150
3110 RETURN
3120 '
